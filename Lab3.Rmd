---
title: "Lab3"
author: "Jonathan Kim"
date: "2/10/2022"
output: html_document
---
(1A)  Plot the prior graph for a situation for a coin where the prior belief for p(head) is represented by the following R code :

		dexp(x, rate =5) / 0.9932621

for values of 0 <= x <= 1 and 0 otherwise.  (We choose the denominator to make the Integral between 0 and 1 sum to 1).

```{r}
rm(list=ls())
seq1=seq(0,1,0.01)
vals <- vector(mode="double",length=length(seq1));
for (i in 1:length(seq1)) {
  vals[i] <- dexp(seq1[i],rate=5) / 0.9932621
}
plot(vals)
```

(1B)  Calculate the posterior graph with both the Metropolis algorithm and grid approximation for a case with 14 heads and 10 tails (where x = prob(head)).
Show the two methods roughly agree.  Compare these to a plot with a posterior for new data of 14 heads and 10 tails with a prior with beta(40,40).

(So for the observation of 14 heads and 10 tails you will end up with a graph with three plots superimposed: (i) the Metropolis algorithm with an exp prior, (ii) grid approximation with an exp prior and (iii) exact analytical solution from a beta(40,40) prior make the plots different colors so you can visualize them…)

```{r}
rm(list=ls())
piOld <- 0.5

numIterations<- 50000
posteriorDist <- vector(length=numIterations)

for (i in 1:numIterations) {
  # our prior with 9 heads and 9 tails
  # our new data with 14 heads and 10 tails
  pOld <- dexp(piOld, rate=5)/0.9932621 * dbinom(14, 24, piOld)
  
  piNew <- piOld + rnorm(1, 0, sd=0.01);
  
  if (piNew>1) 
    piNew = 1;
  
  if (piNew < 0) 
    piNew = 0;
  
  pNew <- dexp(piNew, rate=5)/0.9932621 * dbinom(14, 24, piNew)
  
  ratio <- pNew/pOld
  
  if (ratio > 1 || ratio >= runif(1))
    piOld = piNew;
  
  posteriorDist[i]=piOld;
}

myHist <- hist(posteriorDist, breaks=200,plot=FALSE)
plot(myHist$mids, myHist$counts/numIterations, col="red")

# grid approach to beta prior using a naive (brute force) numerical integration algorithm

posteriorDist <- vector(length=length(myHist$mids))
xVals <- myHist$mids;

i <- 1;
sum <- 0;
for( x in xVals )
{
	posteriorDist[i] <- dexp( x, rate=5 )/0.9932621 * dbinom( 14, 24, x)
	sum = sum + posteriorDist[i];
	i <- i + 1;	
}

lines(myHist$mids,posteriorDist / sum ,col="blue") 
lines(myHist$mids,dbeta(myHist$mids, 9+14, 9+10)/sum(dbeta(myHist$mids,23,19)),col="black")
legend('topleft', legend=c("Metropolis", "Grid Approx","Exact"), col=c("red", "blue","black"),lty=1:2,cex=0.8)
```

(1C)  Repeat the above calculation but for a case of 583 heads and 417 tails. 
(You may need to adjust your model step parameters to try and get the grid and Metropolis graphs to match up).  How do the three posterior curves relate to each other now?  Why does this plot look different than the plot in (1B)?

```{r}
rm(list=ls())
piOld <- 0.5

numIterations<- 50000
posteriorDist <- vector(length=numIterations)

for (i in 1:numIterations) {
  # our prior with 9 heads and 9 tails
  # our new data with 14 heads and 10 tails
  pOld <- dexp(piOld, rate=5)/0.9932621 * dbinom(583, 1000, piOld)
  
  piNew <- piOld + rnorm(1, 0, sd=0.01);
  
  if (piNew>1) 
    piNew = 1;
  
  if (piNew < 0) 
    piNew = 0;
  
  pNew <- dexp(piNew, rate=5)/0.9932621 * dbinom(583, 1000, piNew)
  
  ratio <- pNew/pOld
  
  if (ratio > 1 || ratio >= runif(1))
    piOld = piNew;
  
  posteriorDist[i]=piOld;
}

myHist <- hist(posteriorDist, breaks=200,plot=FALSE)
plot(myHist$mids, myHist$counts/numIterations, col="red")

# grid approach to beta prior using a naive (brute force) numerical integration algorithm

posteriorDist <- vector(length=length(myHist$mids))
xVals <- myHist$mids;

i <- 1;
sum <- 0;
for( x in xVals )
{
	posteriorDist[i] <- dexp( x, rate=5 )/0.9932621 * dbinom( 583, 1000, x)
	sum = sum + posteriorDist[i];
	i <- i + 1;	
}

lines(myHist$mids,posteriorDist / sum ,col="blue") 
lines(myHist$mids,dbeta(myHist$mids, 9+583, 9+417)/sum(dbeta(myHist$mids,9+583,9+417)),col="black")
legend('topleft', legend=c("Metropolis", "Grid Approx","Exact"), col=c("red", "blue","black"),lty=1:2,cex=0.8)
```
The three posterior graphs look much closer to each other than in 1b) due to the central limit theorem. As the trial numbers increase, they all approach a normal distribution or the expected distribution.

Send graphs and code in your e-mail.     (See next slide for hints!)
HINTS:

Watch your x-axis and y-axis scales here…

Make sure all your curves are evaluated on the same set of x sequences.

If someDistribution holds the results of your Metropolis walks, you can use..

	myHist <- hist(someDistribution,breaks=200,plot=FALSE)

to bin those results and then myHist$mids will hold the values for the x-axis for all your graphs.

Make sure the sum of each curve is equal to 1 when you graph them…

So for the above histogram, you could plot…

plot( myHist$mids, myHist$counts/length(someDistribution),main=“Plot title here”)

You can add ylim() and xlim() as parameters to zoom in or zoom out as appropriate for that graph

Then to add another distribution (that can be evaluated as a function ranging from 0 to 1) to the same graph:

aSum <- sum(nextDistribution(myHist$mids))
lines( myHist$mids, nextDistribution(myHist$mids)/aSum,col="red") 

(See lecture 7, slide 5 for an example of scaling….)